<?xml version="1.0" encoding="UTF-8"?>

<properties>
    <!--    查询所有正在处理或者未签收的流程节点  qingl2      -->
	<property name="getProcessNodeUnComplete">
		<![CDATA[
			
select t1.*,t2.user_realname as realName,t2.org_id as orgId ,t2.user_mobiletel1 as mobile from 
			(

			select 1 as state, -- 任务状态（1未签收2未处理）
			       a.id_ as taskId, --任务id
			       a.name_ as taskName, --任务名称
			       a.create_time_ as createTime, --任务创建时间
			       i.user_id_ as userId, --处理人
			       b.name_ as processName, --流程名称
			       a.proc_inst_id_ as procInstanceId , --流程实例id
			       A.TASK_DEF_KEY_ as taskDefKey, --任务节点key
			       c.NOTICERATE as  noticeRate, --预警频率
			       c.duration_node as duration, --处理工时（毫秒）
			       c.messagetempleid as messageTempleId, -- 短信模板
			       c.emailtempleid as emailTempleId, -- 邮件模板
			       c.is_contain_holiday as isContainHoliday -- 工时规则0 ：24时工作制 1： 自然日 2 ：正常工作制
			  from ACT_RU_TASK a
			 inner join ACT_RU_IDENTITYLINK I on I.TASK_ID_ = a.ID_
			  left join act_re_procdef b on b.id_ = a.proc_def_id_
			  left JOIN (SELECT A.PROCESS_KEY,
			                    B.PROCESS_ID,
			                    B.NODE_KEY,
			                    B.DURATION_NODE,
			                    B.ADVANCESEND,
			                    B.OVERTIMESEND,
			                    A.NOTICERATE,
			                    A.MESSAGETEMPLEID,
			                    A.EMAILTEMPLEID,
			                    A.IS_CONTAIN_HOLIDAY
			               FROM TD_WF_PROC_MESSTEMPLATE A
			               LEFT JOIN TD_WF_NODE_WORKTIME B ON A.PROCESS_KEY =
			                                                  B.PROCESS_KEY) c on c.process_id =
			                                                                      a.proc_inst_id_
			                                                                  and c.node_key =
			                                                                      a.task_def_key_
			
			 WHERE a.ASSIGNEE_ is null
			   and I.TYPE_ = 'candidate'
			   and a.suspension_state_ = 1 --运行中状态
			   and c.DURATION_NODE > 0 -- 处理工时
			   and (c.ADVANCESEND = 0 -- 预警发送 0未发送 1发送成功 2 发送失败
			       or c.overtimesend = 0) -- 超时发送 0未发送 1发送成功 2 发送失败
			
			union
			
			SELECT 2 AS state,
			       a.id_ as taskid, --任务id
			       A.NAME_ as taskName,
			       A.CREATE_TIME_ as createTime,
			       A.ASSIGNEE_ as userId,
			       B.NAME_ as processName,
			       a.proc_inst_id_ as procInstanceId,
			       A.TASK_DEF_KEY_ as taskDefKey,
			       c.NOTICERATE as  noticeRate,
			       c.duration_node  as duration,
			       c.messagetempleid  as messageTempleId,
			       c.emailtempleid  as emailTempleId,
			       c.is_contain_holiday  as isContainHoliday
			  FROM ACT_RU_TASK A
			  LEFT JOIN ACT_RE_PROCDEF B ON B.ID_ = A.PROC_DEF_ID_
			  left JOIN (SELECT A.PROCESS_KEY,
			                    B.PROCESS_ID,
			                    B.NODE_KEY,
			                    B.DURATION_NODE,
			                    B.ADVANCESEND,
			                    B.OVERTIMESEND,
			                    A.NOTICERATE,
			                    A.MESSAGETEMPLEID,
			                    A.EMAILTEMPLEID,
			                    A.IS_CONTAIN_HOLIDAY
			               FROM TD_WF_PROC_MESSTEMPLATE A
			               LEFT JOIN TD_WF_NODE_WORKTIME B ON A.PROCESS_KEY =
			                                                  B.PROCESS_KEY) c on c.process_id =
			                                                                      a.proc_inst_id_
			                                                                  and c.node_key =
			                                                                      a.task_def_key_
			
			 WHERE A.ASSIGNEE_ IS NOT NULL
			   AND A.SUSPENSION_STATE_ = 1 --运行中状态
			   and c.DURATION_NODE > 0
			   and (c.ADVANCESEND = 0 -- 预警发送 0未发送 1发送成功 2 发送失败
			       or c.overtimesend = 0) -- 超时发送 0未发送 1发送成功 2 发送失败

	   ) t1 left join (
			
			select t1.user_name , t1.user_realname,t1.user_id,t1.user_mobiletel1,t2.org_id from
			
			TD_SM_USER t1 left join  TD_SM_USERJOBORG t2 on t1.user_id = t2.user_id
			
			) t2 on t1.userId = t2.user_name
		]]>
	</property>
	
	
	
</properties>